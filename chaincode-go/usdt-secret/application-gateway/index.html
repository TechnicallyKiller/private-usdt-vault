<!DOCTYPE html>
<html>
<head>
    <title>AES STEGO VAULT</title>
    <style>
        body { font-family: 'Consolas', monospace; background: #000; color: #00ff00; padding: 40px; text-align: center; }
        .drop-zone { border: 2px dashed #444; padding: 60px; margin: 30px auto; width: 400px; border-radius: 15px; cursor: pointer; transition: 0.3s; background: #111; }
        .drop-zone:hover { border-color: #00ff00; background: #002200; box-shadow: 0 0 20px #00ff00; }
        .logs { text-align: left; max-width: 600px; margin: 0 auto; color: #888; font-size: 13px; height: 300px; overflow-y: auto; border-top: 1px solid #333; padding-top: 10px; }
        .success { font-size: 28px; color: #fff; background: #008800; padding: 20px; border-radius: 10px; margin-top: 20px; display: inline-block; }
    </style>
</head>
<body>
    <h1>üïµÔ∏è ENCRYPTED PIXEL ACCESS</h1>
    <p>Drop Secure Steganography Image to Login</p>

    <div class="drop-zone" id="drop-zone">
        <span style="font-size: 50px;">üñºÔ∏è</span><br><br>
        DROP IMAGE HERE
        <input type="file" id="fileInput" hidden>
    </div>

    <div id="result"></div>
    <div class="logs" id="logs">System Ready.</div>

    <script>
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('fileInput');

        dropZone.onclick = () => fileInput.click();
        fileInput.onchange = (e) => processFile(e.target.files[0]);
        dropZone.ondragover = (e) => { e.preventDefault(); };
        dropZone.ondrop = (e) => { e.preventDefault(); processFile(e.dataTransfer.files[0]); };

        function processFile(file) {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = (e) => sendLogin(e.target.result);
        }

        async function sendLogin(imgData) {
            const logs = document.getElementById('logs');
            const resBox = document.getElementById('result');
            logs.innerHTML += '<div>üîÑ Reading Pixels...</div>';
            resBox.innerHTML = '';

            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 8000); // 8s timeout

            try {
                const res = await fetch('http://localhost:3000/api/stego-login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ imageData: imgData }),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                const data = await res.json();

                data.logs.forEach((l, i) => {
                    setTimeout(() => {
                        logs.innerHTML += `<div>${l}</div>`;
                        logs.scrollTop = logs.scrollHeight;
                    }, i * 150);
                });

                setTimeout(() => {
                    if (data.success) {
                        resBox.innerHTML = `<div class="success">ACCESS GRANTED<br>${data.role}<br>${data.data.value} USDT</div>`;
                    } else {
                        resBox.innerHTML = `<div style="color:red; font-size:24px;">‚õî ${data.message}</div>`;
                    }
                }, data.logs.length * 150);

            } catch (err) {
                if (err.name === 'AbortError') {
                    logs.innerHTML += `<div style="color:red">‚è±Ô∏è TIMEOUT: Image too complex. Try a smaller one.</div>`;
                } else {
                    logs.innerHTML += `<div style="color:red">‚ùå ERROR: Server Offline</div>`;
                }
            }
        }
    </script>
</body>
</html>